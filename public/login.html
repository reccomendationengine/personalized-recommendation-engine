<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Log in</title>

  <!-- Styles live under /public/styles/ -->
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
  <header>
    <h1>Log in</h1>
  </header>

  <main>
    <form id="loginForm" action="/login" method="POST" novalidate style="max-width:420px;">
      <div style="display:flex; flex-direction:column; gap:12px;">
        <label for="email">
          Email
          <input id="email" name="email" type="email" autocomplete="username"
                 placeholder="you@example.com" required>
        </label>

        <label for="password">
          Password
          <input id="password" name="password" type="password" autocomplete="current-password"
                 placeholder="••••••••" required minlength="6">
        </label>

        <button type="submit">Log in</button>

        <p style="margin:4px 0 0;">
          New here? <a href="signup.html">Create an account</a>
        </p>

        <p id="error" role="alert" style="display:none; color:#b00020; margin-top:4px;"></p>
      </div>
    </form>
  </main>

  <script>
    // Utility: very light email check
    function isValidEmail(v) {
      // not strict RFC; just enough for client-side UX
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
    }

    // Prefill email from querystring (?email=...)
    (function prefillFromQuery() {
      try {
        var params = new URLSearchParams(location.search);
        var qsEmail = params.get('email');
        if (qsEmail) {
          var emailInput = document.getElementById('email');
          if (emailInput) emailInput.value = qsEmail;
        }
      } catch (e) { /* ignore */ }
    })();

    // Handle submit: validate + remember email for "Returning user"
    (function attachSubmitHandler() {
      var form = document.getElementById('loginForm');
      var emailInput = document.getElementById('email');
      var passwordInput = document.getElementById('password');
      var errorEl = document.getElementById('error');

      if (!form) return;

      form.addEventListener('submit', function (e) {
        var email = (emailInput && emailInput.value || "").trim();
        var password = (passwordInput && passwordInput.value || "");

        // Basic client-side validation
        var messages = [];
        if (!email) messages.push("Email is required.");
        else if (!isValidEmail(email)) messages.push("Enter a valid email address.");

        if (!password) messages.push("Password is required.");
        else if (password.length < 6) messages.push("Password must be at least 6 characters.");

        if (messages.length > 0) {
          e.preventDefault();
          if (errorEl) {
            errorEl.textContent = messages.join(" ");
            errorEl.style.display = "block";
          }
          return;
        }

        // Store last email so index page can offer "Continue as ..."
        try { localStorage.setItem('lastEmail', email); } catch (err) { /* ignore */ }

        // Let the form POST to /login; server handles redirect (e.g., to /welcome.html)
      });
    })();
  </script>
</body>
</html>
